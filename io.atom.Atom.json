{
  "app-id": "io.atom.Atom",
  "runtime": "org.freedesktop.Sdk",
  "runtime-version": "1.6",
  "base": "io.atom.electron.BaseApp",
  "base-version": "stable",
  "branch": "beta",
  "sdk": "org.freedesktop.Sdk",
  "command": "atom-beta",
  "rename-desktop-file": "atom-beta.desktop",
  "separate-locales": false,
  "finish-args": [
      "--share=ipc", "--socket=x11",
      "--socket=pulseaudio",
      "--share=network",
      "--device=dri",
      "--filesystem=host",
      "--talk-name=org.freedesktop.Notifications",
      "--talk-name=org.freedesktop.secrets"
    ],
  "modules": [
    {
      "name": "atom",
      "buildsystem": "simple",
      "build-commands": [
        "./script/build --install=/app",
        "install -Dm644 io.atom.Atom.appdata.xml /app/share/appdata/io.atom.Atom.appdata.xml",
        "install -Dm644 resources/app-icons/beta/png/1024.png /app/share/icons/hicolor/1024x1024/apps/io.atom.Atom.png",
        "install -Dm644 resources/app-icons/beta/png/512.png /app/share/icons/hicolor/512x512/apps/io.atom.Atom.png",
        "install -Dm644 resources/app-icons/beta/png/256.png /app/share/icons/hicolor/256x256/apps/io.atom.Atom.png",
        "install -Dm644 resources/app-icons/beta/png/128.png /app/share/icons/hicolor/128x128/apps/io.atom.Atom.png",
        "install -Dm644 resources/app-icons/beta/png/64.png /app/share/icons/hicolor/64x64/apps/io.atom.Atom.png",
        "install -Dm644 resources/app-icons/beta/png/32.png /app/share/icons/hicolor/32x32/apps/io.atom.Atom.png",
        "desktop-file-edit --set-icon=io.atom.Atom /app/share/applications/atom-beta.desktop",
        "desktop-file-edit --set-key=Exec --set-value='atom-beta %F' /app/share/applications/atom-beta.desktop",
        "install -m755 atom-beta /app/bin/atom-beta"
      ],
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/atom/atom/archive/v1.22.0-beta0.tar.gz",
          "sha256": "0a83224fe14ec47ed6193b1398b380fdd742fb5209b7e3955aae19c326bfdd67"
        },
        {
          "type": "file",
          "path": "io.atom.Atom.appdata.xml"
        },
        {
          "type": "script",
          "dest-filename": "atom-beta",
          "commands": [
            "exec env ATOM_HOME=\"$XDG_DATA_HOME\" /app/share/atom-beta/atom \"$@\""
          ]
        }
      ],
      "modules": [
        {
          "name": "nodejs",
          "cleanup": [
            "/lib/node_modules/npm/docs",
            "/lib/node_modules/npm/changelogs",
            "/lib/node_modules/npm/html",
            "/lib/node_modules/npm/man",
            "/share"
          ],
          "sources": [
            {
              "type": "archive",
              "url": "https://nodejs.org/dist/v6.11.4/node-v6.11.4.tar.gz",
              "sha256": "94557aa1b9adaa71a424eb7efe8877d7e65bda6e496350c4bac5f64ec715bb1c"
            }
          ]
        },
        {
            "name": "libsecret",
            "config-opts": [
                "--disable-manpages",
                "--disable-gtk-doc",
                "--disable-static",
                "--disable-introspection"
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/pkgconfig",
                "/share/gtk-doc",
                "*.la"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.gnome.org/pub/GNOME/sources/libsecret/0.18/libsecret-0.18.5.tar.xz",
                    "sha256": "9ce7bd8dd5831f2786c935d82638ac428fa085057cc6780aba0e39375887ccb3"
                },
                {
                    "type": "shell",
                    "commands": ["autoreconf -f"]
                }
            ]
        },
        {
          "name": "xkbfile",
          "cleanup": ["/include", "/lib/*.la", "/lib/pkgconfig"],
          "config-opts": ["--disable-static"],
          "sources": [
            {
              "type": "archive",
              "url": "https://www.x.org/releases/individual/lib/libxkbfile-1.0.9.tar.bz2",
              "sha256": "51817e0530961975d9513b773960b4edd275f7d5c72293d5a151ed4f42aeb16a"
            }
          ]
        }
      ]
    },
    {
      "name": "pyls",
      "buildsystem": "simple",
      "build-commands": [
        "python3 setup.py install --prefix=/app"
      ],
      "build-options": {
        "build-args": [
          "--share=network"
        ]
      },
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/palantir/python-language-server/archive/0.8.0.tar.gz",
          "sha256": "b278c7fd4a2c34e0038ee1ec4c76e463f6361ba2b2d03666ad43ae33f862f209"
        }
      ]
    },
    {
      "name": "clang",
      "buildsystem": "cmake-ninja",
      "builddir": true,
      "cleanup": [
        "/include",
        "*.a",
        "/lib/LLVMHello.so",
        "/lib/cmake"
      ],
      "config-opts": [
        "-DCMAKE_BUILD_TYPE=Release",
        "-DFFI_INCLUDE_DIR=/usr/lib/libffi-3.2.1/include",
        "-DCLANG_ENABLE_ARCMT:BOOL=ON",
        "-DCLANG_ENABLE_STATIC_ANALYZER:BOOL=ON",
        "-DCLANG_INCLUDE_DOCS:BOOL=OFF",
        "-DCLANG_INCLUDE_TESTS:BOOL=OFF",
        "-DCLANG_PLUGIN_SUPPORT:BOOL=ON",
        "-DCLANG_BUILD_EXAMPLES:BOOL=OFF",
        "-DLLVM_LIBDIR_SUFFIX=",
        "-DLLVM_ENABLE_LIBCXX:BOOL=OFF",
        "-DLLVM_ENABLE_ZLIB:BOOL=ON",
        "-DLLVM_ENABLE_FFI:BOOL=ON",
        "-DLLVM_ENABLE_RTTI:BOOL=ON",
        "-DLLVM_BUILD_RUNTIME:BOOL=ON",
        "-DLLVM_BUILD_TOOLS:BOOL=ON",
        "-DLLVM_INCLUDE_TOOLS:BOOL=ON",
        "-DLLVM_INCLUDE_TESTS:BOOL=OFF",
        "-DLLVM_INCLUDE_EXAMPLES:BOOL=OFF",
        "-DLLVM_INCLUDE_UTILS:BOOL=ON",
        "-DLLVM_INSTALL_UTILS:BOOL=OFF",
        "-DLLVM_INCLUDE_DOCS:BOOL=OFF",
        "-DLLVM_ENABLE_DOXYGEN:BOOL=OFF",
        "-DLLVM_BUILD_LLVM_DYLIB:BOOL=OFF",
        "-DLLVM_BUILD_EXTERNAL_COMPILER_RT:BOOL=ON",
        "-DLLVM_INSTALL_TOOLCHAIN_ONLY:BOOL=OFF",
        "-DLLVM_TARGETS_TO_BUILD=X86"
      ],
      "sources": [
          {
            "type": "archive",
            "url": "http://llvm.org/releases/5.0.0/llvm-5.0.0.src.tar.xz",
            "sha256": "e35dcbae6084adcf4abb32514127c5eabd7d63b733852ccdb31e06f1373136da"
          },
          {
            "type": "archive",
            "url": "http://llvm.org/releases/5.0.0/cfe-5.0.0.src.tar.xz",
            "sha256": "019f23c2192df793ac746595e94a403908749f8e0c484b403476d2611dd20970",
            "dest": "tools/clang"
          },
          {
            "type": "archive",
            "url": "https://releases.llvm.org/5.0.0/clang-tools-extra-5.0.0.src.tar.xz",
            "sha256": "87d078b959c4a6e5ff9fd137c2f477cadb1245f93812512996f73986a6d973c6",
            "dest": "tools/clang/tools/extra"
          }
      ],
      "modules": [
        {
          "name": "z3",
          "buildsystem": "simple",
          "build-commands": [
            "python3 scripts/mk_make.py --prefix=/app",
            "make -C build -j$(nproc)",
            "make -C build install"
          ],
          "cleanup": ["/bin", "/include"],
          "sources": [
            {
              "type": "archive",
              "url": "https://github.com/Z3Prover/z3/archive/z3-4.5.0.tar.gz",
              "sha256": "aeae1d239c5e06ac183be7dd853775b84698db1265cb2258e5918a28372d4a0c"
            }
          ]
        }
      ]
    }
  ]
}
